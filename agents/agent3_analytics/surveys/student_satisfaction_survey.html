<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ankieta Zadowolenia - Chat Uczelni</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .question-group {
            margin-bottom: 25px;
        }
        
        .question-text {
            font-size: 16px;
            color: #333;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .question-text .required {
            color: #e74c3c;
        }
        
        .option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .option label {
            cursor: pointer;
            flex: 1;
            color: #555;
        }
        
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .likert-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .likert-item input {
            width: 30px;
            height: 30px;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .likert-item label {
            font-size: 12px;
            text-align: center;
            color: #666;
            cursor: pointer;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
        
        input[type="email"],
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        input[type="email"]:focus,
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 40px;
            justify-content: center;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-width: 150px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-reset {
            background: #ecf0f1;
            color: #333;
            min-width: 150px;
        }
        
        .btn-reset:hover {
            background: #bdc3c7;
        }
        
        .progress {
            background: #ecf0f1;
            height: 4px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            background: #667eea;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 600px) {
            .form-container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .likert-scale {
                flex-direction: column;
            }
            
            .likert-item {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Ankieta Zadowolenia</h1>
            <p>Rozmowa z Chatem Uczelni</p>
        </div>
        
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <form class="form-container" id="surveyForm">
            <!-- Sekcja 1: Informacje Podstawowe -->
            <div class="section">
                <h2 class="section-title">üìå Informacje Podstawowe</h2>
                
                <div class="question-group">
                    <p class="question-text">Jaki by≈Ç cel Twojej rozmowy z chatem? <span class="required">*</span></p>
                    <div class="option">
                        <input type="radio" id="q1_1" name="q1" value="Pytanie o przedmiot/kurs" required>
                        <label for="q1_1">Pytanie o przedmiot/kurs</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q1_2" name="q1" value="Pomoc w projekcie/pracƒô zaliczeniowƒÖ">
                        <label for="q1_2">Pomoc w projekcie/pracƒô zaliczeniowƒÖ</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q1_3" name="q1" value="Informacje o zasadach zaliczenia">
                        <label for="q1_3">Informacje o zasadach zaliczenia</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q1_4" name="q1" value="Pytanie techniczne">
                        <label for="q1_4">Pytanie techniczne</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q1_5" name="q1" value="Inne">
                        <label for="q1_5">Inne</label>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Ile czasu trwa≈Ça Twoja rozmowa z chatem? <span class="required">*</span></p>
                    <div class="option">
                        <input type="radio" id="q2_1" name="q2" value="Mniej ni≈º 5 minut" required>
                        <label for="q2_1">Mniej ni≈º 5 minut</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q2_2" name="q2" value="5-15 minut">
                        <label for="q2_2">5-15 minut</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q2_3" name="q2" value="15-30 minut">
                        <label for="q2_3">15-30 minut</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q2_4" name="q2" value="Powy≈ºej 30 minut">
                        <label for="q2_4">Powy≈ºej 30 minut</label>
                    </div>
                </div>
            </div>
            
            <!-- Sekcja 2: Ocena Zadowolenia -->
            <div class="section">
                <h2 class="section-title">‚≠ê Ocena Zadowolenia</h2>
                
                <div class="question-group">
                    <p class="question-text">Czy chat rozumia≈Ç Twoje pytania? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q3_1" name="q3" value="1" required>
                            <label for="q3_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q3_2" name="q3" value="2">
                            <label for="q3_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q3_3" name="q3" value="3">
                            <label for="q3_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q3_4" name="q3" value="4">
                            <label for="q3_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q3_5" name="q3" value="5">
                            <label for="q3_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy odpowiedzi by≈Çy jasne i zrozumia≈Çe? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q4_1" name="q4" value="1" required>
                            <label for="q4_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q4_2" name="q4" value="2">
                            <label for="q4_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q4_3" name="q4" value="3">
                            <label for="q4_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q4_4" name="q4" value="4">
                            <label for="q4_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q4_5" name="q4" value="5">
                            <label for="q4_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy chat udzieli≈Ç Ci dok≈Çadnych informacji? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q5_1" name="q5" value="1" required>
                            <label for="q5_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q5_2" name="q5" value="2">
                            <label for="q5_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q5_3" name="q5" value="3">
                            <label for="q5_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q5_4" name="q5" value="4">
                            <label for="q5_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q5_5" name="q5" value="5">
                            <label for="q5_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy odpowiedzi by≈Çy u≈ºyteczne dla rozwiƒÖzania Twojego problemu? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q6_1" name="q6" value="1" required>
                            <label for="q6_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q6_2" name="q6" value="2">
                            <label for="q6_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q6_3" name="q6" value="3">
                            <label for="q6_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q6_4" name="q6" value="4">
                            <label for="q6_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q6_5" name="q6" value="5">
                            <label for="q6_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy chat potrafi≈Ç byƒá pomocny w bardziej zaawansowanych pytaniach? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q7_1" name="q7" value="1" required>
                            <label for="q7_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q7_2" name="q7" value="2">
                            <label for="q7_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q7_3" name="q7" value="3">
                            <label for="q7_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q7_4" name="q7" value="4">
                            <label for="q7_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q7_5" name="q7" value="5">
                            <label for="q7_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sekcja 3: Do≈õwiadczenie U≈ºytkownika -->
            <div class="section">
                <h2 class="section-title">üë• Do≈õwiadczenie U≈ºytkownika</h2>
                
                <div class="question-group">
                    <p class="question-text">Jak oceniasz og√≥≈Çem do≈õwiadczenie z chatem? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q8_1" name="q8" value="1" required>
                            <label for="q8_1">Bardzo z≈Çe</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q8_2" name="q8" value="2">
                            <label for="q8_2">Z≈Çe</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q8_3" name="q8" value="3">
                            <label for="q8_3">≈örednie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q8_4" name="q8" value="4">
                            <label for="q8_4">Dobre</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q8_5" name="q8" value="5">
                            <label for="q8_5">Doskona≈Çe</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy chat by≈Ç ≈Çatwy w obs≈Çudze? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q9_1" name="q9" value="1" required>
                            <label for="q9_1">Bardzo trudny</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q9_2" name="q9" value="2">
                            <label for="q9_2">Trudny</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q9_3" name="q9" value="3">
                            <label for="q9_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q9_4" name="q9" value="4">
                            <label for="q9_4">≈Åatwy</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q9_5" name="q9" value="5">
                            <label for="q9_5">Bardzo ≈Çatwy</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy czas odpowiedzi chata by≈Ç zadowalajƒÖcy? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q10_1" name="q10" value="1" required>
                            <label for="q10_1">Za wolno</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q10_2" name="q10" value="2">
                            <label for="q10_2">Trochƒô wolno</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q10_3" name="q10" value="3">
                            <label for="q10_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q10_4" name="q10" value="4">
                            <label for="q10_4">Szybko</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q10_5" name="q10" value="5">
                            <label for="q10_5">Bardzo szybko</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy rozumiesz, jak pracuje ten chat (AI)? <span class="required">*</span></p>
                    <div class="likert-scale">
                        <div class="likert-item">
                            <input type="radio" id="q11_1" name="q11" value="1" required>
                            <label for="q11_1">Wcale nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q11_2" name="q11" value="2">
                            <label for="q11_2">Raczej nie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q11_3" name="q11" value="3">
                            <label for="q11_3">Neutralnie</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q11_4" name="q11" value="4">
                            <label for="q11_4">Raczej tak</label>
                        </div>
                        <div class="likert-item">
                            <input type="radio" id="q11_5" name="q11" value="5">
                            <label for="q11_5">Ca≈Çkowicie</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sekcja 4: Por√≥wnanie z Alternatywami -->
            <div class="section">
                <h2 class="section-title">‚öñÔ∏è Por√≥wnanie z Alternatywami</h2>
                
                <div class="question-group">
                    <p class="question-text">Czy wolisz rozmawiaƒá z chatem czy p√≥j≈õƒá na konsultacje do nauczyciela? <span class="required">*</span></p>
                    <div class="option">
                        <input type="radio" id="q12_1" name="q12" value="Zdecydowanie wolƒô chat" required>
                        <label for="q12_1">Zdecydowanie wolƒô chat</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q12_2" name="q12" value="Raczej wolƒô chat">
                        <label for="q12_2">Raczej wolƒô chat</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q12_3" name="q12" value="Nie ma r√≥≈ºnicy">
                        <label for="q12_3">Nie ma r√≥≈ºnicy</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q12_4" name="q12" value="Raczej wolƒô konsultacje">
                        <label for="q12_4">Raczej wolƒô konsultacje</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q12_5" name="q12" value="Zdecydowanie wolƒô konsultacje">
                        <label for="q12_5">Zdecydowanie wolƒô konsultacje</label>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy chcia≈Çby≈õ/chcia≈Çaby≈õ korzystaƒá z tego chata w przysz≈Ço≈õci? <span class="required">*</span></p>
                    <div class="option">
                        <input type="radio" id="q13_1" name="q13" value="Zdecydowanie tak" required>
                        <label for="q13_1">Zdecydowanie tak</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q13_2" name="q13" value="Raczej tak">
                        <label for="q13_2">Raczej tak</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q13_3" name="q13" value="Nie wiem">
                        <label for="q13_3">Nie wiem</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q13_4" name="q13" value="Raczej nie">
                        <label for="q13_4">Raczej nie</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q13_5" name="q13" value="Zdecydowanie nie">
                        <label for="q13_5">Zdecydowanie nie</label>
                    </div>
                </div>
            </div>
            
            <!-- Sekcja 5: Opinie i Sugestie -->
            <div class="section">
                <h2 class="section-title">üí≠ Dodatkowe Opinie i Sugestie</h2>
                
                <div class="question-group">
                    <p class="question-text">Co najbardziej Ci siƒô spodoba≈Ço w rozmowie z chatem?</p>
                    <textarea id="q14" name="q14" placeholder="Wpisz swojƒÖ opiniƒô..."></textarea>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Co mog≈Çoby byƒá lepsze? Jakie sƒÖ Twoje sugestie?</p>
                    <textarea id="q15" name="q15" placeholder="Wpisz sugestie..."></textarea>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy napotyka/≈Çe≈õ na jakie≈õ problemy lub b≈Çƒôdy?</p>
                    <textarea id="q16" name="q16" placeholder="Opisz problemy..."></textarea>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Czy chat powinien wiedzieƒá o czym≈õ, aby byƒá bardziej pomocny?</p>
                    <textarea id="q17" name="q17" placeholder="Wpisz dodatkowe informacje..."></textarea>
                </div>
            </div>
            
            <!-- Sekcja 6: Dane Kontaktowe -->
            <div class="section">
                <h2 class="section-title">üìû Dane Kontaktowe (Opcjonalne)</h2>
                
                <div class="question-group">
                    <p class="question-text">Czy mogƒÖ siƒô z TobƒÖ skontaktowaƒá w celu wyja≈õnienia Twoich odpowiedzi?</p>
                    <div class="option">
                        <input type="radio" id="q18_1" name="q18" value="Tak">
                        <label for="q18_1">Tak</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="q18_2" name="q18" value="Nie">
                        <label for="q18_2">Nie</label>
                    </div>
                </div>
                
                <div class="question-group">
                    <p class="question-text">Tw√≥j email (je≈õli chcesz otrzymywaƒá aktualizacje)</p>
                    <input type="email" id="q19" name="q19" placeholder="Tw√≥j email...">
                </div>
                
                <div class="question-group">
                    <p class="question-text">Tw√≥j numer albumu (opcjonalnie, dla anonimowo≈õci)</p>
                    <input type="text" id="q20" name="q20" placeholder="Nr albumu...">
                </div>
            </div>
            
            <!-- Przyciski -->
            <div class="button-group">
                <button type="reset" class="btn-reset">Wyczy≈õƒá formularz</button>
                <button type="submit" class="btn-submit">Wy≈õlij ankietƒô</button>
            </div>
        </form>
    </div>
    
    <script>
        const form = document.getElementById('surveyForm');
        const progressBar = document.getElementById('progressBar');
        
        // Update progress bar
        function updateProgress() {
            const inputs = form.querySelectorAll('input[required], textarea[required]');
            const filled = Array.from(inputs).filter(input => input.value.trim() !== '').length;
            const percentage = (filled / inputs.length) * 100;
            progressBar.style.width = percentage + '%';
        }
        
        // Generate next response number
        function getNextResponseNumber() {
            const stored = localStorage.getItem('survey_response_counter') || '0';
            const nextNum = parseInt(stored) + 1;
            localStorage.setItem('survey_response_counter', nextNum.toString());
            return nextNum;
        }
        
        // Convert form data to survey response format
        function formToSurveyResponse(formData) {
            const responseNum = getNextResponseNumber();
            const now = new Date();
            
            // Calculate satisfaction score (average of Likert questions)
            const likertQuestions = ['q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11'];
            const scores = likertQuestions.map(q => {
                const val = formData[q];
                return val ? parseInt(val) : 0;
            }).filter(v => v > 0);
            const satisfactionScore = scores.length > 0 ? (scores.reduce((a, b) => a + b) / scores.length).toFixed(2) : 0;
            
            return {
                response_id: `resp_${String(responseNum).padStart(3, '0')}`,
                timestamp: now.toISOString(),
                student_id: `student_${Math.floor(Math.random() * 90000) + 10000}`,
                student_email: formData.q19 || null,
                album_number: formData.q20 || null,
                
                // Basic Information
                q1_goal: formData.q1 || null,
                q2_duration: formData.q2 || null,
                
                // Satisfaction (Likert scales as strings)
                q3_understanding: formData.q3 || null,
                q4_clarity: formData.q4 || null,
                q5_accuracy: formData.q5 || null,
                q6_usefulness: formData.q6 || null,
                q7_advanced_questions: formData.q7 || null,
                
                // User Experience
                q8_overall_experience: formData.q8 || null,
                q9_ease_of_use: formData.q9 || null,
                q10_response_time: formData.q10 || null,
                q11_ai_understanding: formData.q11 || null,
                
                // Comparison
                q12_chat_vs_teacher: formData.q12 || null,
                q13_future_use: formData.q13 || null,
                
                // Feedback
                q14_positive: formData.q14 || null,
                q15_improvements: formData.q15 || null,
                q16_problems: formData.q16 || null,
                q17_additional_info: formData.q17 || null,
                
                // Contact
                q18_contact_allowed: formData.q18 || null,
                
                // Calculated score
                satisfaction_score: parseFloat(satisfactionScore)
            };
        }
        
        // Download JSON file
        function downloadJSON(data, filename) {
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // Send to server
        async function sendToServer(data) {
            try {
                const response = await fetch('/api/surveys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return {success: true, data: result};
                } else {
                    console.error('Server error:', response.status);
                    return {success: false, error: `Server error: ${response.status}`};
                }
            } catch (error) {
                console.error('Network error:', error);
                return {success: false, error: error.message};
            }
        }
        
        form.addEventListener('change', updateProgress);
        form.addEventListener('keyup', updateProgress);
        
        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Convert to survey response format
            const surveyResponse = formToSurveyResponse(data);
            const filename = `${surveyResponse.response_id}.json`;
            
            console.log('Survey response:', surveyResponse);
            
            // Show loading state
            const submitBtn = form.querySelector('.btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‚è≥ Wysy≈Çanie...';
            submitBtn.disabled = true;
            
            try {
                // Send to server/Qdrant
                const serverResult = await sendToServer(surveyResponse);
                
                if (serverResult.success) {
                    // Download JSON file locally
                    downloadJSON(surveyResponse, filename);
                    
                    // Show success message with server response
                    alert(`‚úÖ Dziƒôkujemy za wype≈Çnienie ankiety!\n\n` +
                          `Status: ${serverResult.data.status}\n` +
                          `Response ID: ${serverResult.data.response_id}\n` +
                          `Point ID: ${serverResult.data.point_id}\n\n` +
                          `Plik "${filename}" zosta≈Ç pobrany.\n` +
                          `Wyniki zosta≈Çy zapisane w Qdrancie.`);
                } else {
                    // Server failed, but we can still save locally
                    downloadJSON(surveyResponse, filename);
                    
                    alert(`‚ö†Ô∏è Ankieta zapisana lokalnie!\n\n` +
                          `B≈ÇƒÖd wysy≈Çania do serwera: ${serverResult.error}\n\n` +
                          `Plik "${filename}" zosta≈Ç pobrany.\n` +
                          `Prosimy spr√≥bowaƒá wys≈Çaƒá ankietƒô ponownie.`);
                }
            } catch (error) {
                console.error('Error:', error);
                
                // Fallback: save locally
                downloadJSON(surveyResponse, filename);
                
                alert(`‚ö†Ô∏è B≈ÇƒÖd podczas wysy≈Çania!\n\n` +
                      `${error.message}\n\n` +
                      `Plik "${filename}" zosta≈Ç pobrany.`);
            } finally {
                // Restore button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
        
        // Initial progress update
        updateProgress();
    </script>
</body>
</html>
